---
title: 支持阻塞式与非阻塞式访问
linkTitle: 06.block&non_block
weight: 12
---

阻塞式访问代表着 `TLB` 的端口同时仅支持一个请求，阻塞端口带 `valid-ready` 握手信号。在 `TLB` 准备好接收请求时，会将 `ready` 置 `1`，由外部检测到 `ready` 后会发送请求。请求到达 `TLB` 时 `valid` 为 `1` 则 `TLB` 接收请求并将 `ready` 置 `0`，不再接受新的请求。之后 `TLB` 会对请求进行匹配，查找结果，如果 `miss` 则发送 `ptw` 请求（同样为阻塞），等待直到 `ptw` 返回结果（物理地址或 `pf` 异常），然后 `TLB` 将结果保存并上报给请求方，再将 `ready` 置 `1`。

对于非阻塞式请求，仅带 `valid` 信号，每当 `valid` 置 `1`，`TLB` 即接受请求并在下一拍返回结果（`hit/miss/异常`），无论是否命中都能在请求下一拍得到结果。如果 `miss` 的话，`TLB` 在返回 `miss` 结果同时会发起 `PTW` 请求（非阻塞），`PTW` 接收到请求则进行处理，在处理完成后回填进 `TLB` 中，然后如果请求方再次发起请求就可以命中。在香山 `ITLB` 的具体实现中，`TLB` 本体虽然是非阻塞的，不存储请求的信息，但当前端发起的取指请求 `miss` 后，将会由前端进行调度不断发起相同取指请求直到 `hit`，才能将指令送到处理器进行处理，因此会体现出阻塞的效果。

| 请求来源  | iCache                      | IFU                       |
|-----------|----------------------------|--------------------------|
| 请求数量  | 2                          | 1                        |
| 请求类型  | 非阻塞请求                | 阻塞请求                 |
| 握手信号  | 仅带 valid 信号            | 带 valid 和 ready 信号   |
| 处理方式  | 可以继续处理其他指令      | 等待 iTLB 响应后继续处理指令 |